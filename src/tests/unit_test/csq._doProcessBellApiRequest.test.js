/* eslint-disable no-underscore-dangle */
import csq from '../../controllers/CheckServiceQualificationController';
import BellApi from '../../vendor_api/BellApi';

csq._doProcessBellApiRequest = jest.fn();

test('Should process and validate Bell API request', () => {
  const bellProcessRequest = csq._doProcessBellApiRequest.mockReturnValue(
    '<?xml version="1.0" encoding="UTF-8"?><soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><soapenv:Body><getPresaleProductsResponse xmlns="urn:ca.bell.ots.productqualificationservice"><getPresaleProductsReturn xmlns=""><responseHeader><receiveDateTime>2020-11-18T17:09:51.336Z</receiveDateTime><processedDateTime>2020-11-18T17:09:52.742Z</processedDateTime><responseSystem>B2B Qualification</responseSystem><successIndicator>Success</successIndicator></responseHeader><requestDetail><addressQueryDetail><address><streetNumber>253</streetNumber><streetName>ST PAUL</streetName><streetType>ST</streetType><municipalityCity>BURLINGTON</municipalityCity><provinceOrState>ON</provinceOrState><postalCode>L7R3J7</postalCode></address></addressQueryDetail></requestDetail><addressMatch>ExactMatch</addressMatch><addressList><addressInfo><address><streetNumber>253</streetNumber><streetName>ST PAUL</streetName><streetType>ST</streetType><municipalityCity>BURLINGTON</municipalityCity><provinceOrState>ON</provinceOrState><postalCode>L7R3J7</postalCode></address></addressInfo><numberOfAddresses>1</numberOfAddresses></addressList><servicePointInformation><servicePointCharacteristicsList><servicePointCharacteristics><category>Copper</category><areServicesSupported>Yes</areServicesSupported><propertyLst><property><name>QualificationID</name><value>000042445</value></property><property><name>WholesaleType</name><value>GAS</value></property><property><name>RateBand</name><value>B</value></property><property><name>NetworkType</name><value>FTTN</value></property><property><name>IsBondable</name><value>Y</value></property><property><name>DownloadSpeed</name><value>57388</value></property><property><name>UploadSpeed</name><value>22318</value></property><property><name>EstimatedDownloadSpeed</name><value>50.0</value></property><property><name>EstimatedUploadSpeed</name><value>22.3</value></property><property><name>DownloadSpeedPB</name><value>105020</value></property><property><name>UploadSpeedPB</name><value>37941</value></property><property><name>EstimatedDownloadSpeedPB</name><value>50.0</value></property><property><name>EstimatedUploadSpeedPB</name><value>37.9</value></property><property><name>EstimatedDownloadSpeedFib</name><value>0</value></property><property><name>EstimatedUploadSpeedFib</name><value>0</value></property><property><name>DownloadSpeedBus</name><value>57388</value></property><property><name>UploadSpeedBus</name><value>22318</value></property><property><name>EstimatedDownloadSpeedBus</name><value>50.0</value></property><property><name>EstimatedUploadSpeedBus</name><value>22.3</value></property><property><name>DownloadSpeedPBBus</name><value>105020</value></property><property><name>UploadSpeedPBBus</name><value>37941</value></property><property><name>EstimatedDownloadSpeedPBBus</name><value>50.0</value></property><property><name>EstimatedUploadSpeedPBBus</name><value>37.9</value></property><property><name>EstimatedDownloadSpeedFibBus</name><value>0</value></property><property><name>EstimatedUploadSpeedFibBus</name><value>0</value></property><property><name>RemoteHost</name><value>Remote</value></property><property><name>TroubleIndicator</name><value>OK</value></property><property><name>ResBus</name><value>RES</value></property><property><name>FutureDate</name><value></value></property></propertyLst></servicePointCharacteristics></servicePointCharacteristicsList></servicePointInformation><offeringList><offering><offeringID>GASR006008N</offeringID><offeringDescription>Legacy 6.0 with 0.800 upload</offeringDescription></offering><offering><offeringID>GASR00701N</offeringID><offeringDescription>FTTN 7.0 with 1.0 upload</offeringDescription></offering><offering><offeringID>GASR01001N</offeringID><offeringDescription>FTTN 10.0 with 1.0 upload</offeringDescription></offering><offering><offeringID>GASR01007N</offeringID><offeringDescription>FTTN 10.0 with 7.0 upload</offeringDescription></offering><offering><offeringID>GASR01501N</offeringID><offeringDescription>FTTN 15.0 with 1.0 upload</offeringDescription></offering><offering><offeringID>GASR01510N</offeringID><offeringDescription>FTTN 15.0 with 10.0 upload</offeringDescription></offering><offering><offeringID>GASR02510N</offeringID><offeringDescription>FTTN 25.0 with 10.0 upload</offeringDescription></offering><offering><offeringID>GASR05010N</offeringID><offeringDescription>FTTN 50.0 with 10.0 upload</offeringDescription></offering><offering><offeringID>GASB000640064N</offeringID><offeringDescription>Legacy 0.640 with 0.640 upload</offeringDescription></offering><offering><offeringID>GASB001008N</offeringID><offeringDescription>Legacy 1.0 with 0.8 upload</offeringDescription></offering><offering><offeringID>GASB006008N</offeringID><offeringDescription>Legacy 6.0 with 0.8 upload</offeringDescription></offering><offering><offeringID>GASB01001N</offeringID><offeringDescription>FTTN 10.0 with 1.0 upload</offeringDescription></offering><offering><offeringID>GASB01007N</offeringID><offeringDescription>FTTN 10.0 with 7.0 upload</offeringDescription></offering><offering><offeringID>GASB01601N</offeringID><offeringDescription>FTTN 16.0 with 1.0 upload</offeringDescription></offering><offering><offeringID>GASB01610N</offeringID><offeringDescription>FTTN 16.0 with 10.0 upload</offeringDescription></offering><offering><offeringID>GASB02510N</offeringID><offeringDescription>FTTN 25.0 with 10.0 upload</offeringDescription></offering><offering><offeringID>GASB05010N</offeringID><offeringDescription>FTTN 50.0 with 10.0 upload</offeringDescription></offering></offeringList></getPresaleProductsReturn></getPresaleProductsResponse></soapenv:Body></soapenv:Envelope>'
  );

  const bellApi = new BellApi();
  const bellResponse = bellApi.getParsedPresaleProductsReturn(
    bellProcessRequest()
  );

  const success = bellResponse[0].responseHeader[0].successIndicator[0];
  const addressMatch = bellResponse[0].addressMatch[0];

  expect(success).toBe('Success');
  expect(success).not.toBe('Failed');
  expect(addressMatch).toBe('ExactMatch');
});
